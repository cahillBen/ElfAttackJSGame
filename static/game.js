let subgameBackground = [
    [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
    [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
    [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
    [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
    [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
    [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
    [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
    [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
    [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
    [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
    [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
    [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
    [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
    [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
    [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
    [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
    [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
    [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7]
]

let background2 = [
    [48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48],
    [48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48],
    [48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2],
    [16, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 18],
    [16, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 18],
    [16, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 18],
    [16, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 18],
    [16, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 18],
    [16, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 18],
    [16, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 18],
    [16, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 18],
    [16, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 18],
    [16, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 18],
    [16, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 18],
    [16, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 18],
    [16, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 18],
    [16, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 18],
    [16, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 18],
    [32, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 34]
]
let background3 = [
    [39, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 41],
    [52, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 54],
    [65, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 67],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2],
    [13, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 15],
    [13, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 15],
    [13, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 15],
    [13, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 15],
    [13, 14, 14, 14, 14,  14, 14, 14,14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 15],
    [13, 14, 14, 14, 14,  14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 15],
    [13, 14, 14, 14, 14,  14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 15],
    [13, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14,  14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 15],
    [13, 14, 14, 14, 14,  14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 15],
    [13, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 15],
    [13, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 15],
    [26, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 15],
    [ 5, 26, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 15],
    [ 5,  5, 26, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 15],
    [ 5,  5,  5, 26, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 15],
    [ 5,  5,  5,  5,  26, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 28]
]

let background4 = [
    [39, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 41],
    [52, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 54],
    [65, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 67],
    [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5],
    [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5],
    [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5],
    [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5],
    [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5],
    [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5],
    [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5],
    [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5],
    [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5],
    [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5],
    [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5],
    [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5],
    [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5],
    [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5],
    [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5],
    [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5],
    [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5]
]

let background5 = [
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2],
    [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 7, 7, 7, 7, 7, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 7, 7, 7, 7, 7, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 7, 7, 7, 7, 7, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 7, 7, 7, 7, 7, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 17, 18, 18, 18, 18, 18, 19],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 27, 57, 58, 58, 58, 59, 29],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 27, 67, 68, 68, 68, 69, 29],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 27, 77, 78, 78, 78, 79, 29],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 27, 77, 97, 78, 97, 79, 29],
    [0, 0, 0, 1, 0, 1, 0, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 27, 77, 78, 88, 78, 79, 29],
    [2, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 0, 0, 2, 2, 2, 2, 0, 0, 0, 0, 2, 2, 2, 2, 27, 77, 79, 98, 77, 79, 29],
    [3, 0, 0, 0, 3, 3, 3, 3, 3, 3, 3, 0, 0, 0, 3, 3, 3, 0, 0, 0, 0, 3, 3, 3, 3, 37, 38, 38, 38, 38, 38, 39]
]

let background6 = [
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2],
    [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 7, 7, 7, 7, 7, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 7, 7, 7, 7, 7, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 7, 7, 7, 7, 7, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 7, 7, 7, 7, 7, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 17, 18, 18, 18, 18, 18, 19],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 27, 7, 7, 7, 7, 7, 29],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 27, 7, 7, 7, 7, 7, 29],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 27, 7, 7, 7, 7, 7, 29],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 27, 7, 7, 7, 7, 7, 29],
    [0, 0, 0, 1, 0, 1, 0, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 27, 7, 7, 7, 7, 7, 29],
    [2, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 0, 0, 2, 2, 2, 2, 0, 0, 0, 0, 2, 2, 2, 2, 27, 7, 7, 7, 7, 7, 29],
    [3, 0, 0, 0, 3, 3, 3, 3, 3, 3, 3, 0, 0, 0, 3, 3, 3, 0, 0, 0, 0, 3, 3, 3, 3, 37, 38, 38, 38, 38, 38, 39]
]
let background7 = [
    [51, 52, 52, 52, 52, 52, 52, 52, 52, 52, 52, 52, 52, 52, 52, 52, 52, 52, 52, 52, 52, 52, 52, 52, 52, 52, 52, 52, 52, 52, 53, 54],
    [67, 68, 68, 68, 68, 68, 68, 68, 68, 68, 68, 68, 68, 68, 68, 68, 68, 68, 68, 68, 68, 68, 68, 68, 68, 68, 68, 68, 68, 68, 69, 70],
    [83, 84, 84, 84, 84, 84, 84, 84, 84, 84, 84, 84, 84, 84, 84, 84, 84, 84, 84, 84, 84, 84, 84, 84, 84, 84, 84, 84, 84, 84, 84, 86],
    [83, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86],
    [83, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86],
    [83, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86],
    [83, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86],
    [83, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86],
    [83, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86],
    [83, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86],
    [83, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86],
    [83, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86],
    [83, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86],
    [83, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86],
    [83, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86],
    [83, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86],
    [83, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86],
    [83, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86],
    [83, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86],
    [65, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 66]
]

let background9 = [
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2],
    [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18],
    [0, 7, 7, 7, 7, 7, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 7, 7, 7, 7, 7, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 7, 7, 7, 7, 7, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 0, 7, 1, 2, 2, 1, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 7, 8, 1, 2, 2, 7, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 8, 8, 8, 7, 2, 3, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 7, 8, 3, 3, 0, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 7, 7, 8, 9, 0, 0],
    [0, 0, 0, 1, 0, 1, 0, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 7, 7, 7, 0, 0, 1, 2],
    [2, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 0, 0, 2, 2, 2, 2, 0, 0, 0, 0, 2, 2, 2, 2, 2, 0, 1, 1, 1, 0, 0],
    [3, 0, 0, 0, 3, 3, 3, 3, 3, 3, 3, 0, 0, 0, 3, 3, 3, 0, 0, 0, 0, 3, 3, 3, 3, 0, 0, 1, 1, 3, 7, 9]
]

let main_element;
let xhttp;
let button_id;
let healthpackList = [];
let score = 0;
let backgroundCount = 1;
let boost = false;
let request;
let fpsInterval = 1000 / 15;
let then = Date.now();
let tilesPerRow = 10;
let tileSize = 16;
let backgroundCountX = 0;
let backgroundCountY = 0;
let subgameFinished = false;
let paused = true;
let characterSelection = false;
let gameRefresh = "rules";
let gameToGame = false;
//https://stackoverflow.com/questions/9419263/how-to-play-audio
var backgroundMusic = new Audio("../static/bensound-badass.mp3");
//backgroundMusic.play();

let loadSubGame = false;
let loadLevel1 = false;
let loadLevel2 = false;
let loadLevel3 = false;
let loadLevel4 = false;
let loadLevel5 = false;
let loadLevel6 = false;
let loadLevel7 = false;
let loadLevel8 = false;
let loadLevel9 = false;
let loadLevel10 = false;
let tutorialLoad = false;
let gameLoad = false;
let gameLoaded = false;
let gameMode;
let scoreSubmitted = false;

let activeTornado = false;
let tornadoCount = 0;

let arrowSpeed = 6;
let arrowList = [];
let obstacleList = [];
let landmineList = [];
let playerImage = new Image();
let characterMale = new Image();
let characterFemale = new Image();
let swordImage = new Image();
let bowImage = new Image();
let arrowImage = new Image();
let gameover = new Image();
let lizardImage = new Image();
let skeletonImage = new Image();
let wizardImage = new Image();
let dragonImage = new Image();
let landmineImage = new Image();
let healthpackImage = new Image();
let explodeImage = new Image();
let tornadoImage = new Image();
let tiny16Image = new Image();
let desertImage = new Image();
let caveImage = new Image();
let grassImage = new Image();
let sewerImage = new Image();
let rock = new Image();
let bat = new Image();

rock.src = "../static/rock.png";
bat.src = "../static/silverbat.png";
characterMale.src = "../static/nightelf_male1.png";
characterFemale.src = "../static/nightelf_female.png";
lizardImage.src = "../static/lizard.png";
skeletonImage.src = "../static/skeleton.png";
dragonImage.src = "../static/dragon.png"
wizardImage.src = "../static/wizard.png";
swordImage.src = "../static/sword.png";
bowImage.src = "../static/bow.png";
arrowImage.src = "../static/arrow.png";
tiny16Image.src = "../static/tiny-16.png";
desertImage.src = "../static/desert.png";
caveImage.src = "../static/cave.png";
sewerImage.src = "../static/sewer_1.png";
grassImage.src = "../static/tiles.png";
gameover.src = "../static/gameover.png";
landmineImage.src = "../static/landmine.png";
healthpackImage.src = "../static/heart_transparent.png";
explodeImage.src = "../static/explosionFull.png";
tornadoImage.src = "../static/whirlwind.png";

let moveLeft = false;
let moveUp = false;
let moveRight = false;
let moveDown = false;
let enemiesList = [];
let backgroundList = [[subgameBackground, "../static/tiles.png", 6, 16, [1]], [background2, "../static/sewer_1.png", 16, 16, [48]], [background3, "../static/desert.png", 13, 16, [66, 67, 65]], [background5, "../static/tiny-16.png", 10, 16, [13, 18, 27, 15, 66]], [background6, "../static/tiny-16.png", 10, 16, [13, 18, 27, 15, 66]], [background7, "../static/cave.png", 16, 24, [83, 33, 86, 84]]]
let randomBackground;

let level =1;

let rock1 = {
    x: 512,
    y: 280,
    height: 10,
    width: 10
}
let rock2 = {
    x: 712,
    y: 280,
    height: 10,
    width: 10
}
let bat1 = {
    x: 512,
    y: 232,
    height: 48,
    width: 32,
    frameX: 0,
    frameY: 1
}
let healthpack = {
    x: randint(5, 505),
    y: randint(5, 305),
    width: 20,
    height: 20,
    obtained: false
}
let player = {
    x: 82,
    y: 148,
    height: 48,
    width: 32,
    frameX: 0,
    frameY: 0,
    xChange: 0,
    yChange: 0,
    wepon: "sword",
    health: 100,
    character: "player",
    movement: true,
    inAir: false,
    teleporting: false,
    teleportCount: false,
    invincible: false
};

let landmine = {
    x: 80,
    y: 80,
    height: 16,
    width: 16,
    distance: 2000,
    pictureWidth: 256,
    pictureHeight: 256,
    pictureX: 0,
    pictureY: 0,
    explode: false
}

let sword = {
    height: 194,
    width: 256,
    frameX: 0,
    frameY: 0
}

let bow = {
    height: 80,
    width: 80,
    frameX: 1,
    frameY: 0
}

let tornado = {
    height: 19,
    width: 64 / 4,
    frameX: 0,
    frameY: 0,
    x: 100,
    y: 100
}
let canvas = document.querySelector("canvas");
let context = canvas.getContext("2d");
let floor = canvas.height - 27;
let continueKey = " ";
let hitKey = "h";
let shootKey = "f";
let invincibleKey = "i";
let skipKey = "s";
let data;
document.addEventListener("DOMContentLoaded", init, false);

function init() {
    let xhttpKey = new XMLHttpRequest();
    //xhttp.addEventListener("readystatechange", key_response, false);
    //    https://www.w3schools.com/xml/ajax_xmlhttprequest_response.asp
    xhttpKey.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
            let data = JSON.parse(xhttpKey.responseText)
            continueKey = data["continueKey"];
            hitKey = data["hitKey"];
            shootKey = data["shootKey"];
            skipKey = data["skipKey"];
            invincibleKey = data["invincibleKey"];
        }
    };
    xhttpKey.open("GET", "/~bc23/cgi-bin/ca2/run.py/return_keys", true); //    /~bc23/cgi-bin/ca2/run.py
    xhttpKey.send(null);


    main_element = document.querySelector("main");
    let button_elements = document.querySelectorAll("nav button");
    for (let b of button_elements) {
        b.addEventListener("click", fetch_content, false);
    }
    fetch_content(null);
}

function fetch_content(event) {
    if (event == null) {
        button_id = gameRefresh;
    } else {
        button_id = event.target.id;
    }
    xhttp = new XMLHttpRequest();
    xhttp.addEventListener("readystatechange", handle_response, false);

    xhttp.open("GET", "/~bc23/cgi-bin/ca2/run.py/" + button_id, true); //    /~bc23/cgi-bin/ca2/run.py
    xhttp.send(null);
    if (button_id === "game") {
        if (gameToGame === true) {
            gameRefresh = "game";
            gameToGame = false;
            initialise()
        }
        gameToGame = true;
        document.querySelector("canvas").style.display = "block";
        player.health = 100;
        level = 1;
        gameLoad = true;
        tutorialLoad = false;
        gameMode = "game";
        subgameFinished = false;
        scoreSubmitted = false;
        drawAll()
    } else if (button_id === "tutorial") {
        if (gameToGame === true) {
            gameRefresh = "tutorial";
            gameToGame = false;
            initialise()
        }
        gameToGame = true;
        document.querySelector("canvas").style.display = "block";
        player.health = 100;
        player.x = 40;
        level = 1;
        gameLoad = true;
        tutorialLoad = false;
        gameMode = "tutorial";
        drawAll()
    } else {
        gameToGame = false
        document.getElementById("title").innerHTML = "";
        document.getElementById("underGame").innerHTML = "";
        document.querySelector("canvas").style.display = "none";
    }
    if (button_id === "scores") {
        document.getElementById("title").innerHTML = "Leaderboard";
    } else if (button_id === "username") {
        document.getElementById("title").innerHTML = "Choose your Username";
    }
}


function handle_response() {
    if (xhttp.readyState === 4) {
        if (xhttp.status === 200) {
            main_element.innerHTML = xhttp.responseText;
        }
    }
}

function randomLevel() {
    player.x = canvas.width * .5;
    player.y = canvas.height * .5;
    document.getElementById("title").innerHTML = "Level " + String(level);
    backgroundCountX = 0;
    backgroundCountY = 0;
    obstacleList = [];
    enemiesList = [];
    landmineList = [];
    healthpackList = [];
    arrowList = [];
    let randomCount = randint(0, backgroundList.length - 1);
    randomBackground = backgroundList[randomCount];
    assignObstacles(randomBackground[0], obstacleList, randomBackground[3], randomBackground[4])

    randomCount = randint(0, 1);
    for (let i = 0; i < randomCount; i++) {
        let wizard = {
            x: randint(50, 450),
            y: randint(50, 250),
            height: 48,
            width: 32,
            frameX: 0,
            frameY: 0,
            xChange: 1,
            yChange: 0,
            health: 100,
            character: "wizard",
            spellX: 0,
            spellY: 0,
            spellCount: 0,
            count: 0,
            movement: true
        };
        enemiesList.push(wizard);
    }

    randomCount = randint(0, 1);
    for (let i = 0; i < randomCount; i++) {
        let lizard = {
            x: randint(50, 450),
            y: randint(50, 250),
            height: 48,
            width: 39,
            frameX: 0,
            frameY: 0,
            xChange: 1,
            yChange: 0,
            character: "lizard",
            count: 0,
            health: 100,
            movement: true
        };
        enemiesList.push(lizard);
    }

    randomCount = randint(0, 1);
    for (let i = 0; i < randomCount; i++) {
        let skeleton = {
            x: randint(50, 450),
            y: randint(50, 250),
            height: 48,
            width: 32,
            frameX: 0,
            frameY: 0,
            xChange: 1,
            yChange: 0,
            count: 0,
            health: 100,
            wepon: "bow",
            bowFrameX: 0,
            bowFrameY: 0,
            character: "skeleton",
            movement: true
        };
        enemiesList.push(skeleton);
    }

    let healthpack = {
        x: randint(10, 500),
        y: randint(10, 300),
        width: 20,
        height: 20,
        obtained: false
    }
    healthpackList.push(healthpack);
    fpsInterval = 1000 / 15;


    if (enemiesList.length === 0) {
        let skeleton = {
            x: randint(50, 450),
            y: randint(50, 250),
            height: 48,
            width: 32,
            frameX: 0,
            frameY: 0,
            xChange: 1,
            yChange: 0,
            count: 0,
            health: 100,
            wepon: "bow",
            bowFrameX: 0,
            bowFrameY: 0,
            character: "skeleton",
            movement: true
        };
        enemiesList.push(skeleton);
    }
}

function randomDrawLevel() {
    if (button_id === "game") {
        fpsInterval = 1000 / 20;
        document.getElementById("title").innerHTML = "Level " + String(level);
        window.addEventListener("click", mouseClick, false);
        window.addEventListener("keydown", activate, false);
        window.addEventListener("keyup", deactivate, false);
        tilesPerRow = randomBackground[2];
        let backgroundImage = new Image();
        backgroundImage.src = randomBackground[1];
        tileSize = randomBackground[3];
        drawBackground(context, randomBackground[0], canvas, tilesPerRow, backgroundImage, tileSize)
        common(canvas, context, player, enemiesList, obstacleList, playerImage, lizardImage, skeletonImage, wizardImage,
            moveDown, moveLeft, moveRight, moveUp, sword, bow, arrowList, bowImage, swordImage, arrowSpeed, arrowImage)

        healthpacks()

        if (level % 10 === 0) {
            blackout(context, player, canvas)
        }
        healthBar(player, context, canvas)

        GameOver(player, context)
        if (enemiesList.length === 0) {
            paused = true;
            randomLevel()

            level += 1;
            healthpack.obtained = false;
        }
    }
}

function deactivate(event) {
    let key = event.key;
    if (key === "ArrowDown") {
        moveDown = false;
    } else if (key === "ArrowUp") {
        moveUp = false;
    } else if (key === "ArrowRight") {
        moveRight = false;
    } else if (key === "ArrowLeft") {
        moveLeft = false;
    }
}

function activate(event) {
    let key = event.key;
    if (key === "ArrowDown") {
        moveDown = true;
    } else if (key === "ArrowUp") {
        moveUp = true;
    } else if (key === "ArrowRight") {
        moveRight = true;
    } else if (key === "ArrowLeft") {
        moveLeft = true;
    }
    if (key === " " && player.teleportCount * .009 < 2 && (gameMode === "game" || level > 8) && paused === false) {
        player.teleporting = true;
    }
    else if (key === continueKey) {
        paused = false;
    }
    else if (key === shootKey && (gameMode === "game" || level > 1)) {
        shoot(player, arrowList, enemiesList)
    }
    else if (key === hitKey) {
        hit(player, context, enemiesList, arrowList)
    }
    if (key === invincibleKey) {
        if (player.invincible === true) {
            player.invincible = false;
        } else {
            player.invincible = true;
        }
    }
    if (key === skipKey) {
        score = 10;
        enemiesList = [];
    }
}


function assignObstacles(background, obstacleList, tileSize, obstacleInputList) {
    for (let r = 0; r < 20; r += 1) {
        for (let c = 0; c < 32; c += 1) {
            let tile = background[r][c];
            if (obstacleInputList.includes(tile)) {
                let obstacle = {
                    x: c * tileSize,
                    y: r * tileSize,
                    height: tileSize,
                    width: tileSize
                };
                obstacleList.push(obstacle);
            }
        }
    }
}

function randint(min, max) {
    return Math.round(Math.random() * (max - min)) + min;
}


function moveMapCollision(person, obstacle, backgroundCountX, backgroundCountY) {
    if ((person.x > obstacle.x + (obstacle.width * .5) - (backgroundCountX * 8))) {
        person.x = obstacle.x + obstacle.width + 2 - (backgroundCountX * 8);
    }
    if ((person.x + person.width < obstacle.x + (obstacle.width * .5) - (backgroundCountX * 8))) {
        person.x = obstacle.x - (person.width + 2) - (backgroundCountX * 8);
    }
    if ((person.y + person.height < (obstacle.y + (obstacle.height * .5)) - (backgroundCountY * 5))) {
        person.y = obstacle.y - (person.height + 2) - (backgroundCountY * 5);
    }
    if ((person.y > obstacle.y + (obstacle.height * .5) - (backgroundCountY * 5))) {
        person.y = obstacle.y + obstacle.height + 2 - (backgroundCountY * 5);
    }
    person.yChange = 0;
    person.xChange = 0;
}

function shoot(person, arrowList, target) {
    person.wepon = "bow";
    let arrow = {
        x: person.x + (.5 * person.width),
        y: person.y + (.5 * person.height),
        frameY: 0,
        height: 256,
        width: 256,
        shooter: person
    }
    if (person.character === "player") {
        if (target.length === 0) {
            arrow.frameX = 1;
            arrow.direction = -1;
        } else if (person.x > target[0].x) {
            arrow.frameX = 1;
            arrow.direction = -1;
        } else {
            arrow.frameX = 3;
            arrow.direction = 1;
        }
    } else if (person.character === "skeleton") {
        if (person.x > target.x) {
            arrow.frameX = 1;
            arrow.direction = -1;
        } else {
            arrow.frameX = 3;
            arrow.direction = 1;
        }
    }
    arrowList.push(arrow)
}

function hit(player, context, enemiesList, arrowList) {
    player.wepon = "sword"
    // https://www.w3schools.com/tags/canvas_arc.asp
    context.strokeStyle = "orange";
    context.lineWidth = 10;
    context.beginPath();
    if (player.frameY === 0) {
        context.arc(player.x + 15, player.y + 30, 25, .8 * Math.PI, 2.2 * Math.PI, true);
    } else if (player.frameY === 1) {
        context.arc(player.x + 15, player.y + 25, 30, 1.4 * Math.PI, .6 * Math.PI, true);
    } else if (player.frameY === 2) {
        context.arc(player.x + 15, player.y + 25, 30, 1.6 * Math.PI, 2.4 * Math.PI);
    } else if (player.frameY === 3) {
        context.arc(player.x + 15, player.y + 20, 25, 1.2 * Math.PI, 1.8 * Math.PI);
    }
    context.stroke();
    for (let enemy of enemiesList) {
        checkHit(player, enemy, arrowList, true)
    }
}

function checkHit(attacker, target, arrowList, swordHit) {
    if (attacker.wepon === "sword" && swordHit === true) {
        let distance = ((((attacker.x + (attacker.width * .5)) - ((target.x) + (landmine.width * .5))) ** 2) + ((attacker.y + (attacker.height)) - ((target.y + (target.height * .5)))) ** 2) ** .5
        if (distance < 80) {
            target.health -= 10;
            if (attacker.x > target.x) {
                target.x -= 5;
            } else {
                target.x += 5;
            }
            if (attacker.y > target.y) {
                target.y -= 5;
            } else {
                target.y += 5;
            }
        }
        if (target.x < 0) {
            target.x = 0;
        }
        if (target.x + target.width > 512) {
            target.x = 512 - target.width;
        }
    } else if (attacker.wepon === "bow") {
        for (let arrow of arrowList) {
            if (target.health > 0) {
                if ((arrow.x < target.x + target.width && arrow.x + arrow.width - 240 > target.x) && (target.y + target.height > arrow.y && target.y < arrow.y + arrow.height - 240)) {
                    if ((target != arrow.shooter)) {
                        target.health -= 5;
                        let index = arrowList.indexOf(arrow);
                        arrowList.splice(index, 1);
                    }
                }
            }
        }
    }
}

function enemyRandomMove(enemy) {
    if (enemy.health > 0) {
        if (enemy.count === 0) {
            enemy.count = 10;
            enemy.xChange = randint(1, 4)
        } else {
            enemy.frameX = (enemy.frameX + 1) % 4;
            enemy.count -= 1;
            if (enemy.xChange === 1) {
                enemy.frameY = 0;
                enemy.y = enemy.y + 4;
            } else if (enemy.xChange === 2) {
                enemy.frameY = 1;
                enemy.x = enemy.x - 4;
            } else if (enemy.xChange === 3) {
                enemy.frameY = 3;
                enemy.y = enemy.y - 4;
            } else if (enemy.xChange === 4) {
                enemy.frameY = 2;
                enemy.x = enemy.x + 4;
            }
        }
    }
}

function dragonMove(enemy, player) {
    if (enemy.health > 0) {
        if (player.y + player.height >= enemy.y + enemy.height) {
            enemy.y += 3;
            enemy.frameY = 0;
        } else if (player.y + player.height <= enemy.y) {
            enemy.y -= 3;
            enemy.frameY = 3;
        } else {
            if (player.x + player.width >= enemy.x + enemy.width) {
                enemy.x += 3;
                enemy.frameY = 2;
            } else if (player.x + player.width <= enemy.x) {
                enemy.x -= 3;
                enemy.frameY = 1;
            }
        }
        enemy.frameX = (enemy.frameX + 1) % 4;
    }
}

function enemyYAxisMove(enemy, player, arrowList) {
    if (enemy.health > 0) {
        if (enemy.y - 10 > player.y) {
            enemy.y -= 3;
            enemy.frameY = 3;
        } else if (enemy.y > player.y) {
            enemy.y -= 1;
        } else if (enemy.y + 10 < player.y) {
            enemy.y += 3;
            enemy.frameY = 0;
        } else if (enemy.y < player.y) {
            enemy.y += 1;
        }
        if (!(enemy.y + 3 > player.y && enemy.y - 3 < player.y)) {
            enemy.frameX = (enemy.frameX + 1) % 4;
        } else {
            if (enemy.x < player.x) {
                enemy.frameY = 2;
            } else if (enemy.x > player.x) {
                enemy.frameY = 1;
            }
        }
        let chance = randint(1, 20);
        if (chance === 5) {
            shoot(enemy, arrowList, player)
        }
    }
}


function healthpacks() {
    for (let healthpack of healthpackList) {
        if (healthpack.obtained === false) {
            context.drawImage(healthpackImage, healthpack.x, healthpack.y, healthpack.width, healthpack.height)
            if (player.x + player.width > healthpack.x &&
                healthpack.x + healthpack.width > player.x &&
                player.y + player.height > healthpack.y &&
                healthpack.y + healthpack.height > player.y) {
                healthpack.obtained = true;
                player.health += 50;
                if (player.health > 100) {
                    player.health = 100;
                }
                //  https://stackoverflow.com/questions/5767325/how-can-i-remove-a-specific-item-from-an-array
                let index = healthpackList.indexOf(healthpack);
                healthpackList.splice(index, 1);
            }
        }
    }
}

function landmines(landmineList, person, context, landmineImage, explodeImage) {
    for (let landmine of landmineList) {
        if (landmine.explode != false) {
            if (person.character === landmine.explode) {
                context.drawImage(explodeImage,
                    landmine.pictureWidth * landmine.pictureX, landmine.pictureHeight * landmine.pictureY,
                    landmine.pictureWidth, landmine.pictureHeight,
                    landmine.x - 30 - (backgroundCountX * 8), landmine.y - 30 - (backgroundCountY * 5), landmine.width * 5, landmine.height * 5);
                landmine.pictureX += 1;
                person.health -= 3;
                if (landmine.pictureX === 8) {
                    landmine.pictureX = 0;
                    landmine.pictureY += 1;
                    if (landmine.pictureY === 4) {
                        let index = landmineList.indexOf(landmine);
                        landmineList.splice(index, 1);
                    }
                }
            }
        }
        else {
            landmine.distance = ((((person.x + (person.width * .5)) - (landmine.x - (backgroundCountX * 8) + (landmine.width * .5))) ** 2) + ((person.y + (person.height)) - (landmine.y - (backgroundCountY * 5) + (landmine.height * .5))) ** 2) ** .5

            if (landmine.distance < 40 && person.character === "player") {
                landmine.explode = person.character;
            } else if (landmine.distance < 50 && person.character === "dragon") {
                landmine.explode = person.character;
            } else {
                context.drawImage(landmineImage, landmine.x - (backgroundCountX * 8), landmine.y - (backgroundCountY * 5), landmine.width, landmine.height);
            }
        }
    }
}

function spell(enemy, context, player) {
    if (enemy.character === "wizard") {
        enemy.spellCount += 1;
        context.lineWidth = 9;
        context.strokeStyle = "yellow";
        context.beginPath();
        if (enemy.spellCount === 1) {
            enemy.spellX = randint(0, 512)
            enemy.spellY = randint(0, 320)
        } else if (enemy.spellCount > 28) {
            context.strokeStyle = "red";
            spellCheck(enemy, player)
            if (enemy.spellCount === 32) {
                enemy.spellCount = 0;
            }
        }
        context.arc(enemy.spellX, enemy.spellY, 25, 0, 2 * Math.PI, true);
        context.stroke()
    }
}

function spellCheck(enemy, player) {
    let distance = ((((player.x + (player.width * .5)) - enemy.spellX) ** 2) + ((player.y + (player.height)) - enemy.spellY) ** 2) ** .5
    if (distance < 25) {
        player.health -= 15;
    }
}

function teleport() {
    context.strokeStyle = "yellow";
    context.lineWidth = 30;
    context.beginPath();
    if (player.teleportCount * .009 < .2) {
        context.arc(player.x + (player.width * .5), player.y + (player.height * .5), 8, 0, player.teleportCount * .2 * Math.PI);
        context.stroke();
    }
    if (player.teleportCount === 10) {
        player.x = randint(2, canvas.width - (player.width - 2))
        player.y = randint(2, canvas.height - (player.height - 2))
    }
    if (player.teleportCount * .009 < 2) {
        context.strokeStyle = "yellow";
        context.lineWidth = 30;
        context.beginPath();
        context.arc(50, 110, 15, 0, player.teleportCount * .009 * Math.PI);
        context.stroke();
        player.teleportCount += 1;
    } else {
        player.teleporting = false;
        player.teleportCount = 0;
    }
}

function blackout(context, player, canvas) {
    // creates blackout on canvas except 
    context.fillStyle = "black";
    context.fillRect(player.x + (player.width) + 50, 0, canvas.width - player.x, canvas.height);
    context.fillRect(player.x - 50, 0, -(canvas.width + player.x), canvas.height);
    context.fillRect(player.x - 60, 0, player.width + 120, player.y - 50);
    context.fillRect(player.x - 60, player.y + player.height + 50, player.width + 120, (canvas.height - (player.y + player.height)));
    context.strokeStyle = "black";
    context.lineWidth = 50;
    context.beginPath();
    context.arc(player.x + (player.width * .5), player.y + (player.height * .5), 90, 0, 2 * Math.PI, true);
    context.stroke();
}

function drawBackground(context, background, canvas, tilesPerRow, backgroundImage, tileSize) {
    //combine with level 7
    context.clearRect(0, 0, canvas.width, canvas.height);
    context.fillStyle = "black";
    if (background[1][1] === -1) {
        context.fillStyle = "lightgreen";
    }
    context.fillRect(0, 0, canvas.width, canvas.height);
    for (let r = 0; r < 20; r += 1) {
        for (let c = 0; c < 32; c += 1) {
            let tile = background[r][c];
            if (tile >= 0) {
                let tileRow = Math.floor(tile / tilesPerRow);
                let tileCol = Math.floor(tile % tilesPerRow);
                if (tileSize === 24) {
                    context.drawImage(backgroundImage, tileCol * tileSize, tileRow * tileSize, tileSize, tileSize, (c * tileSize) - backgroundCountX * 8, (r * tileSize) - backgroundCountY * 5, tileSize, tileSize);
                } else {
                    context.drawImage(backgroundImage, tileCol * tileSize, tileRow * tileSize, tileSize, tileSize, c * tileSize, r * tileSize, tileSize, tileSize);
                }
            }
        }
    }
}

function common(canvas, context, player, enemiesList, obstacleList, playerImage, lizardImage, skeletonImage, wizardImage,
    moveDown, moveLeft, moveRight, moveUp, sword, bow, arrowList, bowImage, swordImage, arrowSpeed, arrowImage) {

    if (player.health > 0) {
        context.drawImage(playerImage,
            player.width * player.frameX, player.height * player.frameY,
            player.width, player.height,
            player.x, player.y, player.width, player.height);
    }

    for (let enemy of enemiesList) {
        if (enemy.health > 0) {
            // drawing images optimisable
            if (enemy.character === "lizard") {
                enemyRandomMove(enemy)
                context.drawImage(lizardImage,
                    enemy.width * enemy.frameX, enemy.height * enemy.frameY,
                    enemy.width, enemy.height,
                    enemy.x, enemy.y, enemy.width, enemy.height);
            } else if (enemy.character === "wizard") {
                enemyRandomMove(enemy)
                spell(enemy, context, player)
                context.drawImage(wizardImage,
                    enemy.width * enemy.frameX, enemy.height * enemy.frameY,
                    enemy.width, enemy.height,
                    enemy.x, enemy.y, enemy.width, enemy.height);
            } else if (enemy.character === "skeleton") {
                enemyYAxisMove(enemy, player, arrowList)
                context.drawImage(skeletonImage,
                    enemy.width * enemy.frameX, enemy.height * enemy.frameY,
                    enemy.width, enemy.height,
                    enemy.x, enemy.y, enemy.width, enemy.height);
            } else if (enemy.character === "dragon") {
                dragonMove(enemy, player)
                context.drawImage(dragonImage,
                    enemy.width * enemy.frameX, enemy.height * enemy.frameY,
                    enemy.width, enemy.height,
                    enemy.x, enemy.y, enemy.width, enemy.height);
            } else if (enemy.character === "princess") {
                context.drawImage(characterFemale,
                    enemy.width * enemy.frameX, enemy.height * enemy.frameY,
                    enemy.width, enemy.height,
                    enemy.x, enemy.y, enemy.width, enemy.height);
            }
        }
    }

    if ((tornado.y > canvas.height && tornadoCount > 2)) {
        activeTornado = false;
    }
    if (activeTornado) {
        if (player.health > 0) {
            context.drawImage(tornadoImage,
                tornado.width * tornado.frameX, tornado.height * tornado.frameY,
                tornado.width, tornado.height,
                tornado.x, tornado.y, tornado.width * 5, tornado.height * 5);
            tornado.y += 3;
            tornado.frameX = (tornado.frameX + 1) % 4;
            for (let enemy of enemiesList) {
                if (enemy.x + enemy.width > tornado.x && tornado.x + tornado.width * 5 > enemy.x && enemy.y + enemy.height > tornado.y && tornado.y + tornado.height * 5 > enemy.y) {
                    enemy.health -= 1;
                }
            }
            if (tornadoCount < 2 && ((gameMode === "game" || level > 8))) {
                context.strokeStyle = "grey";
                context.lineWidth = 30;
                context.beginPath();
                context.arc(50, 50, 15, 0, tornadoCount * Math.PI);
                context.stroke();
                tornadoCount += .009
            }
        }
    } else if (gameMode === "game" || level > 8) {
        if (!activeTornado) {
            context.drawImage(tornadoImage,
                tornado.width * tornado.frameX, tornado.height * tornado.frameY,
                tornado.width, tornado.height,
                30, 10, tornado.width * 3, tornado.height * 3);
        }
    }

    if ((moveLeft || moveRight || moveUp || moveDown) && !(moveLeft && moveRight)) {
        player.frameX = (player.frameX + 1) % 4;
        if (player.wepon === "sword") {
            sword.frameX = (((sword.frameX - 2) + 1) % 2) + 2;
        } else {
            bow.frameX = (((bow.frameX - 1 - bow.frameY) + 1) % 2) + 1 + bow.frameY;
        }
    }

    if (moveLeft) {
        player.xChange = player.xChange - 0.8;
        player.frameY = 1;
        sword.frameY = 2;
        bow.frameY = 0;
    }
    if (moveRight) {
        player.xChange = player.xChange + 0.8;
        player.frameY = 2;
        sword.frameY = 3;
        bow.frameY = 1;
    }
    if (moveUp) {
        player.yChange = player.yChange - 0.8;
        player.frameY = 3;
        sword.frameY = 0;
        bow.frameY = 4;
    }
    if (moveDown) {
        player.yChange = player.yChange + 0.8;
        player.frameY = 0;
        sword.frameY = 1;
        bow.frameY = 4;
    }

    // player and enemy bow could be combined
    if (player.health > 0) {
        if (!(sword.frameY === 0) && player.wepon === "sword") {
            context.drawImage(swordImage,
                sword.width * sword.frameX, sword.height * sword.frameY,
                sword.width, sword.height,
                player.x - 20, player.y - 35, sword.width * .3, sword.height * .4);
        } else if (player.wepon === "bow" && !(bow.frameY === 4)) {
            context.drawImage(bowImage,
                bow.width * bow.frameX, bow.height * 3,
                bow.width, bow.height,
                player.x + 5, player.y + 10, bow.width * .3, bow.height * .4);
        }
    }

    for (let enemy of enemiesList) {
        if (enemy.health > 0 && enemy.character === "skeleton") {
            if ((enemy.frameY === 1 || enemy.frameY === 2)) {
                if (enemy.frameY === 1) {
                    enemy.bowFrameY = 3;
                } else {
                    enemy.bowFrameY = 0;
                }
                context.drawImage(bowImage,
                    enemy.bowFrameX * bow.width, enemy.bowFrameY * bow.height,
                    bow.width, bow.height,
                    enemy.x + 5, enemy.y + 10, bow.width * .3, bow.height * .4);
            }
        }
    }

    for (let arrow of arrowList) {
        arrow.x = arrow.x + (arrowSpeed * arrow.direction);

        context.drawImage(arrowImage,
            arrow.width * arrow.frameX, arrow.height * arrow.frameY,
            arrow.width, arrow.height,
            arrow.x - 30, arrow.y - 22, arrow.width * .2, arrow.height * .2);
        if (arrow.x > canvas.width || arrow.x < -arrow.width * 2) {
            let index = arrowList.indexOf(arrow);
            arrowList.splice(index, 1);
        }
    }
    for (let enemy of enemiesList) {
        checkHit(player, enemy, arrowList, false)
        checkHit(enemy, player, arrowList, false)
        landmines(landmineList, enemy, context, landmineImage, explodeImage)
    }

    landmines(landmineList, player, context, landmineImage, explodeImage)

    // obstacles
    for (let obstacle of obstacleList) {
        // if player hits background obstacle
        if ((player.x + player.width > obstacle.x - (backgroundCountX * 8) && player.x < obstacle.x + obstacle.width - (backgroundCountX * 8)) && (player.y + player.height > obstacle.y - (backgroundCountY * 5) && player.y < obstacle.y + obstacle.height - (backgroundCountY * 5))) {
            moveMapCollision(player, obstacle, backgroundCountX, backgroundCountY)
        }
        for (let enemy of enemiesList) {
            if ((enemy.x + enemy.width > obstacle.x - (backgroundCountX * 8) && enemy.x < obstacle.x + obstacle.width - (backgroundCountX * 8)) && (enemy.y + enemy.height > obstacle.y - (backgroundCountY * 5) && enemy.y < obstacle.y + obstacle.height - (backgroundCountY * 5))) {
                moveMapCollision(enemy, obstacle, backgroundCountX, backgroundCountY)
            }
            if ((enemy.health) > 0 && (player.x + player.width > enemy.x && player.x < enemy.x + enemy.width) && (player.y + player.height > enemy.y && player.y < enemy.y + enemy.height)) {

                if (enemy.character === "dragon") {
                    player.health = 0;
                } else {
                    moveMapCollision(player, enemy, backgroundCountX, backgroundCountY)
                    player.health -= 1;
                }
            }
        }
    }

    if (player.teleporting === true) {
        teleport()
    }

    for (let enemy of enemiesList) {
        if ((enemy.health) > 0 && (player.x + player.width > enemy.x && player.x < enemy.x + enemy.width) && (player.y + player.height > enemy.y && player.y < enemy.y + enemy.height)) {
            if (enemy.character === "dragon") {
                player.health = 0;
            } else if (enemy.character === "princess") {
                enemy.health += 1;
            } else {
                moveMapCollision(player, enemy, backgroundCountX, backgroundCountY)
                player.health -= 5;
            }
        }
        if (enemy.character === "princess") {
            enemy.health += 1;
            if (enemy.health > 100) {
                enemy.health = 100;
            }
        }
    }


    player.x = player.x + player.xChange;
    player.y = player.y + player.yChange;

    player.yChange = player.yChange * .9;
    player.xChange = player.xChange * .9;

    for (let enemy of enemiesList) {
        if (enemy.health > 0) {
            if (enemy.x < -(backgroundCountX * 8)) {
                enemy.xChange = 4;
            } else if (enemy.x + enemy.width > canvas.width + ((32 - backgroundCountX) * 8)) {
                enemy.xChange = 2;
            }
            if (enemy.y < -(backgroundCountY * 5)) {
                enemy.xChange = 1;
            } else if (enemy.y + enemy.height > canvas.height + ((20 - backgroundCountX) * 5)) {
                enemy.xChange = 3;
            }
        }
    }

    let displaceX = 0;
    let displaceY = 0;
    if (player.x < -2) {
        player.x = -2;
        if (backgroundCountX > 0 && moveLeft && tileSize > 16) {
            backgroundCountX -= 1;
            displaceX = 8;
        }
    } else if (player.x + player.width > canvas.width) {
        player.x = canvas.width - player.width;
        if (backgroundCountX < 32 && moveRight && tileSize > 16) {
            backgroundCountX += 1;
            displaceX = -8;
        }
    }
    if (player.y < 0) {
        player.y = 0;
        if (backgroundCountY > 0 && moveUp && tileSize > 16) {
            backgroundCountY -= 1;
            displaceY = 5;
        }
    } else if (player.y + player.height > canvas.height) {
        player.y = canvas.height - player.height;
        if (backgroundCountY < 20 && moveDown && tileSize > 16) {
            backgroundCountY += 1;
            displaceY = -5;
        }
    }
    for (let enemy of enemiesList) {
        enemy.x += displaceX;
        enemy.y += displaceY;
        if (enemy.character === "wizard") {
            enemy.spellX += displaceX;
            enemy.spellY += displaceY;
        }
    }
    for (let arrow of arrowList) {
        arrow.x += displaceX;
        arrow.y += displaceY;
    }
    healthpack.x += displaceX;
    healthpack.y += displaceY;
    if (activeTornado === true) {
        tornado.x += displaceX;
        tornado.y += displaceY;
    }

    if (tileSize > 16) {
        for (let enemy of enemiesList) {
            if (enemy.x + enemy.width > canvas.width + ((32 - backgroundCountX) * 8)) {
                enemy.x = (canvas.width - ((32 - backgroundCountX) * 8)) - enemy.width
            } else if (enemy.x < - (backgroundCountX * 8)) {
                enemy.x = - (backgroundCountX * 8);
            }
            if (enemy.y + enemy.height > canvas.height + ((20 - backgroundCountY) * 5)) {
                enemy.y = (canvas.height - ((20 - backgroundCountY) * 5)) - enemy.height
            } else if (enemy.y < - (backgroundCountY * 5)) {
                enemy.y = - (backgroundCountY * 5);
            }
        }
    } else {
        for (let enemy of enemiesList) {
            if (enemy.x + enemy.width > canvas.width) {
                enemy.x = canvas.width - enemy.width;
            } else if (enemy.x < 0) {
                enemy.x = 0;
            }
            if (enemy.y + enemy.height > canvas.height) {
                enemy.y = canvas.height - enemy.height;
            } else if (enemy.y < 0) {
                enemy.y = 0;
            }
        }
    }



    // healthbars
    // enemy health
    for (let enemy of enemiesList) {
        if (enemy.health > 0) {
            context.fillStyle = "red";
            context.fillRect(enemy.x + 2, enemy.y - 10, .3 * enemy.health, 2);
        } else {
            let index = enemiesList.indexOf(enemy);
            enemiesList.splice(index, 1);
        }
    }

    for (let enemy of enemiesList) {
        if (enemy.x + enemy.width > canvas.width + (32 - backgroundCountX) * 8) {
            enemy.x = (canvas.width - enemy.width) + (32 - backgroundCountX) * 8
        } else if (enemy.x < -(backgroundCountX * 8)) {
            enemy.x = -backgroundCountX * 8;
        }
        if (enemy.y + enemy.height > canvas.height + (20 - backgroundCountY) * 5) {
            enemy.y = (canvas.height - enemy.height) + (20 - backgroundCountY) * 5
        } else if (enemy.y < -(backgroundCountY * 5)) {
            enemy.y = -backgroundCountY * 5;
        }
    }
}

function healthBar(player, context, canvas) {
    if (player.health > 0) {
        context.fillStyle = "black";
        context.fillRect((canvas.width * .5) - 105, 15, 210, 15);
        context.fillStyle = "red";
        context.fillRect((canvas.width * .5) - 100, 19, 2 * player.health, 7);
    }
}


function pause() {
    context.fillStyle = "grey";
    context.fillRect(0, 0, canvas.width, canvas.height)
    context.font = "20px Ariel";
    context.fillStyle = "white";
    context.textAlign = "center";
    context.fillText("Press " + continueKey + " to Continue", canvas.width / 2, canvas.height / 2);
}


function chooseCharacter() {
    if (characterSelection === false) {
        if (button_id === "game" || button_id === "tutorial") {
            document.getElementById("title").innerHTML = "Choose Your Character";
        }
        player.frameX = (player.frameX + 1) % 4;

        context.clearRect(0, 0, canvas.width, canvas.height);
        context.fillStyle = "grey";
        context.fillRect(0, 0, canvas.width, canvas.height);

        context.drawImage(characterMale,
            player.width * player.frameX, player.height * player.frameY,
            player.width, player.height,
            canvas.width * .25 - (player.width * .5), canvas.height * .5, player.width, player.height);

        context.drawImage(characterFemale,
            player.width * player.frameX, player.height * player.frameY,
            player.width, player.height,
            canvas.width * .75 - (player.width * .5), canvas.height * .5, player.width, player.height);

        context.font = "20px Ariel";
        context.fillStyle = "white";
        context.textAlign = "center";
        context.fillText("Click to choose your character", canvas.width / 2, 250);
    }
}
function subMouseClick(event) {
    //  https://stackoverflow.com/questions/55677/how-do-i-get-the-coordinates-of-a-mouse-click-on-a-canvas-element
    let keyX = event.pageX;
    let fullWidth = document.querySelector("html").clientWidth;
    if ((fullWidth - canvas.width) * .5 < keyX && (keyX < (fullWidth - (fullWidth - canvas.width) * .5))) {
        if (keyX < ((fullWidth - canvas.width) * .5) + (.5 * canvas.width)) {
            playerImage.src = "../static/nightelf_male1.png";
        } else {
            playerImage.src = "../static/nightelf_female.png";
        }
        characterSelection = true;
    }
}

function mouseClick(event) {
    let keyX = event.pageX;
    let fullWidth = document.querySelector("html").clientWidth;
    if ((fullWidth - canvas.width) * .5 < keyX && (keyX < (fullWidth - (fullWidth - canvas.width) * .5))) {
        if (!activeTornado && (gameMode === "game" || level > 8)) {
            tornado.x = (keyX - (fullWidth - canvas.width) * .5) - (tornado.width * 2.5);
            tornado.y = 0 - tornado.height * 5;
            tornadoCount = 0;
            activeTornado = true;
        }
    }
}


function GameOver(player, context) {
    if (player.invincible === true) {
        player.health = 100;
        context.font = "20px Arial";
        context.fillStyle = "blue";
        context.fillText("Invincible", 450, 15);
    }
    if (player.health <= 0) {
        context.drawImage(gameover, canvas.width * .5 - 70, 100, 140, 100);
        window.cancelAnimationFrame(request)
        if (gameMode === "game" && scoreSubmitted === false) {
            scoreSubmitted = true;
            let data = new FormData();
            data.append("score", level)
            xhttp = new XMLHttpRequest();
            xhttp.addEventListener("readystatechange", handle_data, false);
            xhttp.open("POST", "/~bc23/cgi-bin/ca2/run.py/store_score", true);  //       /~bc23/cgi-bin/ca2/run.py
            xhttp.send(data);
        }
    }
}

function handle_data() {
}


function subgame() {
    tilesPerRow = 6;
    document.getElementById("title").innerHTML = "Runnnnnn(nnnnn)";
    document.getElementById("underGame").innerHTML =
        "You must get through this mini-game before the next level<br>You will lose health if you hit an obstacle<br>Use Up-Arrow for small jump<br>Use Space Bar for high jump";

    fpsInterval = 1000 / 30;
    tilesPerRow = 6;
    player.frameY = 2;
    if (score === 10 * 1 + 1) {
        paused = true;
    }
    else if (score <= 10) {
        if (paused) {
            pause()
        }
        else {
            context.clearRect(0, 0, canvas.width, canvas.height);
            context.fillStyle = "#87cefa";
            context.fillRect(0, 0, canvas.width, canvas.height);

            backgroundCount = backgroundCount + 1
            if (backgroundCount === 16) {
                backgroundCount = 0;
            }
            for (let r = 0; r < 20; r += 1) {
                for (let c = 0; c < 35; c += 1) {
                    let tile = subgameBackground[r][c];
                    if (tile >= 0) {
                        let tileRow = Math.floor(tile / tilesPerRow);
                        let tileCol = Math.floor(tile % tilesPerRow);
                        context.drawImage(grassImage, tileCol * tileSize, tileRow * tileSize, tileSize, tileSize,
                            (c * tileSize) - backgroundCount * 2, r * tileSize, tileSize, tileSize);
                    }
                }
            }

            healthBar(player, context, canvas)

            context.font = "30px Arial";
            context.fillStyle = "red";
            context.fillText("Score:" + String(score), 60, 50);

            if (score < 10) {
                if (backgroundCount % 2 === 0) {
                    player.frameX = (player.frameX + 1) % 4;
                }

                context.drawImage(rock, rock1.x, rock1.y - 20, rock1.width * 5, rock1.height * 5);
                rock1.x = rock1.x - 6;
                if (rock1.x < 0 - rock1.width) {
                    rock1.x = canvas.width;
                }
                context.drawImage(rock, rock2.x, rock2.y - 20, rock2.width * 5, rock2.height * 5);
                rock2.x = rock2.x - 6;
                if (rock2.x < 0 - rock2.width) {
                    rock2.x = canvas.width + 20;
                }

                context.drawImage(bat,
                    bat1.width * bat1.frameX, bat1.height * bat1.frameY,
                    bat1.width, bat1.height,
                    bat1.x, bat1.y - 10, bat1.width, bat1.height);
                bat1.frameX = (bat1.frameX + 1) % 4;
                bat1.x = bat1.x - 9;
                if (bat1.x < 0 - bat1.width) {
                    bat1.x = canvas.width;
                    score += 1;
                }

                context.drawImage(playerImage,
                    player.width * player.frameX, player.height * player.frameY,
                    player.width, player.height,
                    player.x, player.y, player.width, player.height);

                if (moveUp && !player.inAir) {
                    player.yChange = player.yChange - 22;
                    player.inAir = true;
                }
                else if (boost && !player.inAir) {
                    player.yChange = player.yChange - 30;
                    player.inAir = true;
                }

                player.y = player.y + player.yChange;

                player.yChange = player.yChange + 2.5;
                player.yChange = player.yChange * .9;

                if (player.y + player.height > floor) {
                    player.inAir = false;
                    player.y = floor - player.height;
                    player.yChange = 0;
                }

                if (player.invincible === true) {
                    player.health = 100;
                    context.font = "20px Arial";
                    context.fillStyle = "blue";
                    context.fillText("Invincible", 450, 15);
                }

                collision(player, rock1)
                collision(player, rock2)
                collision(player, bat1)
            } else {
                context.drawImage(playerImage,
                    player.width * player.frameX, player.height * player.frameY,
                    player.width, player.height,
                    player.x, player.y, player.width, player.height);

                player.frameX = (player.frameX + 1) % 4;
                player.x += 5;
                if (player.y < floor - player.height) {
                    player.y += 5;
                }


                if (player.x > 512) {
                    score += 1;
                    subgameFinished = true;
                    paused = true;
                }
            }
        }
    }


    function collision(player, obstacle) {
        // cases of collision
        if (!((player.x > obstacle.x + obstacle.width) ||
            ((player.x - 15 + player.width < obstacle.x)) ||
            ((player.y - 10 + player.height < obstacle.y)) ||
            ((player.y > obstacle.y)))) {
            player.health -= level;
        }
    }
}

function subGameActivate(event) {
    let key = event.key;
    if (key === "ArrowUp") {
        moveUp = true;
    }
    else if (key === " ") {
        boost = true;
    } else if (key === continueKey) {
        paused = false;
    }
}

function subGameDeactivate(event) {
    let key = event.key;
    if (key === "ArrowUp") {
        moveUp = false;
    }
    else if (key === " ") {
        boost = false;
    }
}


function drawAll() {
    request = window.requestAnimationFrame(drawAll);
    let now = Date.now();
    let elapsed = now - then;
    if (elapsed <= fpsInterval) {
        return;
    };
    then = now - (elapsed % fpsInterval);
    canvas.removeEventListener("click", subMouseClick, false)
    if (characterSelection === false) {
        canvas.addEventListener("click", subMouseClick, false)
        chooseCharacter()
    } else if (gameMode === "game") {
        window.addEventListener("keydown", activate, false)
        if (paused) {
            pause()
        }
        else if (gameLoad === true) {
            window.removeEventListener("keydown", activate, false)
            player.health = 100;
            player.x = (canvas.width / 2) - 150;
            player.y = floor - player.height;
            gameLoad = false;
            level = 1;
            randomLevel()
        }
        if (!paused) {
            randomDrawLevel()
        }
    }
    else if (subgameFinished === false && gameMode === "tutorial") {
        canvas.removeEventListener("click", subMouseClick, false)
        window.addEventListener("keydown", activate, false);
        window.addEventListener("keydown", subGameActivate, false);
        window.addEventListener("keyup", subGameDeactivate, false);
        if (!loadSubGame) {
            tileSize = 16;
            tilesPerRow = 6;
            backgroundMusic.pause();
            player.health = 100;
            score = 0;
            player.x = 40;
            window.addEventListener("click", subGameDeactivate, false);
        }
        subgame()
        loadSubGame = true
    } else if (button_id === "tutorial") {
        fpsInterval = 1000 / 15;
        window.addEventListener("keyup", deactivate, false);
        window.addEventListener("click", mouseClick, false);
        if (level === 1) {
            if (paused) {
                pause()
            } else if (!loadLevel1) {
                level1()
                loadLevel1 = true
            } if (!paused) {
                drawLevel1()
            }
        } else if (level === 2) {
            if (paused) {
                pause()
            }
            else if (!loadLevel2) {
                level2()
                loadLevel2 = true
            } if (!paused) {
                drawLevel2()
            }
        } else if (level === 3) {
            if (paused) {
                pause()
            }
            else if (!loadLevel3) {
                level3()
                loadLevel3 = true
            } if (!paused) {
                drawLevel3()
            }
        } else if (level === 4) {
            if (paused) {
                pause()
            }
            else if (!loadLevel4) {
                level4()
                loadLevel4 = true
            } if (!paused) {
                drawLevel4()
            }
        } else if (level === 5) {
            if (paused) {
                pause()
            }
            else if (!loadLevel5) {
                level5()
                loadLevel5 = true
            } if (!paused) {
                drawLevel5()
            }
        } else if (level === 6) {
            if (paused) {
                pause()
            }
            else if (!loadLevel6) {
                level6()
                loadLevel6 = true
            } if (!paused) {
                drawLevel6()
            }
        } else if (level === 7) {
            if (paused) {
                pause()
            }
            else if (!loadLevel7) {
                level7()
                loadLevel7 = true
            } if (!paused) {
                drawLevel7()
            }
        } else if (level === 8) {
            if (paused) {
                pause()
            }
            else if (!loadLevel8) {
                level8()
                loadLevel8 = true
            } if (!paused) {
                drawLevel8()
            }
        } else if (level === 9) {
            if (paused) {
                pause()
            }
            else if (!loadLevel9) {
                level9()
                loadLevel9 = true
            } if (!paused) {
                drawLevel9()
            }
        }
        else if (level === 10) {
            if (paused) {
                pause()
            }
            else if (!loadLevel10) {
                level10()
                loadLevel10 = true
            } if (!paused) {
                drawLevel10()
            }
        }
        else if (level > 10) {
            finished()
        }
    }
}





function level1() {
    backgroundMusic.play();
    player.x = 50;
    player.y = 200;
    document.getElementById("title").innerHTML = "Level " + String(level);
    document.getElementById("underGame").innerHTML =
        "Use the arrow keys to move around<br>Press " + hitKey + " to attack with your sword<br>Lizards will attack if you get too close<br>Kill all the enemies to get to the next level";

    backgroundCountX = 0;
    backgroundCountY = 0;
    enemiesList = [];
    landmineList = [];
    assignObstacles(subgameBackground, obstacleList, tileSize, [1, 7])
    let lizard = {
        x: 300,
        y: 200,
        height: 48,
        width: 39,
        frameX: 0,
        frameY: 0,
        xChange: 1,
        yChange: 0,
        character: "lizard",
        count: 0,
        health: 100,
        movement: true
    };
    enemiesList.push(lizard);
}


function drawLevel1() {
    if (level === 1) {

        tilesPerRow = 6
        drawBackground(context, subgameBackground, canvas, tilesPerRow, grassImage, tileSize)
        common(canvas, context, player, enemiesList, obstacleList, playerImage, lizardImage, skeletonImage, wizardImage,
            moveDown, moveLeft, moveRight, moveUp, sword, bow, arrowList, bowImage, swordImage, arrowSpeed, arrowImage)

        healthpacks()
        healthBar(player, context, canvas)
        GameOver(player, context, request)
        if (enemiesList.length === 0) {
            level += 1;
            subgameFinished = false;
            loadSubGame = false;
            paused = true;
        }
    }
}


function level2() {
    backgroundMusic.play();
    player.x = 50;
    player.y = 200;
    document.getElementById("title").innerHTML = "Level " + String(level);
    document.getElementById("underGame").innerHTML =
        "Skeletons will try to shoot you<br>You can shoot back by pressing " + shootKey;

    backgroundCountX = 0;
    backgroundCountY = 0;
    enemiesList = [];
    landmineList = [];
    obstacleList = [];
    arrowList = [];
    assignObstacles(background2, obstacleList, tileSize, [48])
    let skeleton = {
        x: 132,
        y: 48,
        height: 48,
        width: 32,
        frameX: 0,
        frameY: 0,
        xChange: 1,
        yChange: 0,
        count: 0,
        health: 100,
        wepon: "bow",
        bowFrameX: 0,
        bowFrameY: 0,
        character: "skeleton",
        movement: true
    };
    skeleton.x = 300
    skeleton.y = 200
    enemiesList.push(skeleton);
}

function drawLevel2() {
    if (level === 2) {
        tilesPerRow = 16
        drawBackground(context, background2, canvas, tilesPerRow, sewerImage, tileSize)
        common(canvas, context, player, enemiesList, obstacleList, playerImage, lizardImage, skeletonImage, wizardImage,
            moveDown, moveLeft, moveRight, moveUp, sword, bow, arrowList, bowImage, swordImage, arrowSpeed, arrowImage)

        healthBar(player, context, canvas)
        GameOver(player, context, request)
        // possible optimise
        if (enemiesList.length === 0) {
            level += 1;
            subgameFinished = false;
            loadSubGame = false;
            paused = true;
        }
    }
}

//level3()
function level3() {
    backgroundMusic.play();
    player.x = 50;
    player.y = 200;
    document.getElementById("title").innerHTML = "Level " + String(level);
    document.getElementById("underGame").innerHTML =
        "There can be multiple enemies at one time<br>You can only shoot one at a time";

    backgroundCountX = 0;
    backgroundCountY = 0;
    enemiesList = [];
    landmineList = [];
    obstacleList = [];
    arrowList = [];

    assignObstacles(background3, obstacleList, tileSize, [66, 67, 65])
    let skeleton = {
        x: 300,
        y: 200,
        height: 48,
        width: 32,
        frameX: 0,
        frameY: 0,
        xChange: 1,
        yChange: 0,
        count: 0,
        health: 100,
        wepon: "bow",
        bowFrameX: 0,
        bowFrameY: 0,
        character: "skeleton",
        movement: true
    };

    enemiesList.push(skeleton);
    let skeleton1 = {
        x: 132,
        y: 48,
        height: 48,
        width: 32,
        frameX: 0,
        frameY: 0,
        xChange: 1,
        yChange: 0,
        count: 0,
        health: 100,
        wepon: "bow",
        bowFrameX: 0,
        bowFrameY: 0,
        character: "skeleton",
        movement: true
    };
    enemiesList.push(skeleton1);
}

function drawLevel3() {
    if (level === 3) {
        tilesPerRow = 13
        drawBackground(context, background3, canvas, tilesPerRow, desertImage, tileSize)
        common(canvas, context, player, enemiesList, obstacleList, playerImage, lizardImage, skeletonImage, wizardImage,
            moveDown, moveLeft, moveRight, moveUp, sword, bow, arrowList, bowImage, swordImage, arrowSpeed, arrowImage)

        healthBar(player, context, canvas)
        GameOver(player, context, request)
        if (enemiesList.length === 0) {
            level += 1;
            subgameFinished = false;
            loadSubGame = false;
            paused = true;
        }
    }
}

//level4()
function level4() {
    backgroundMusic.play();
    player.x = 50;
    player.y = 200;
    document.getElementById("title").innerHTML = "Level " + String(level);
    document.getElementById("underGame").innerHTML =
        "Wizards cast spells on the floor<br>Make sure your feet are outside the circle when they turn red!";

    backgroundCountX = 0;
    backgroundCountY = 0;
    enemiesList = [];
    landmineList = [];
    obstacleList = [];
    arrowList = [];

    assignObstacles(background4, obstacleList, tileSize, [66])
    let wizard = {
        x: 100,
        y: 100,
        height: 48,
        width: 32,
        frameX: 0,
        frameY: 0,
        xChange: 1,
        yChange: 0,
        health: 100,
        character: "wizard",
        spellX: 0,
        spellY: 0,
        spellCount: 0,
        count: 0,
        movement: true
    };
    enemiesList.push(wizard);
    let wizard1 = {
        x: 400,
        y: 100,
        height: 48,
        width: 32,
        frameX: 0,
        frameY: 0,
        xChange: 1,
        yChange: 0,
        health: 100,
        character: "wizard",
        spellX: 0,
        spellY: 0,
        spellCount: 0,
        count: 0,
        movement: true
    };
    enemiesList.push(wizard1);
}

function drawLevel4() {
    if (level === 4) {
        tilesPerRow = 13
        drawBackground(context, background4, canvas, tilesPerRow, desertImage, tileSize)

        common(canvas, context, player, enemiesList, obstacleList, playerImage, lizardImage, skeletonImage, wizardImage,
            moveDown, moveLeft, moveRight, moveUp, sword, bow, arrowList, bowImage, swordImage, arrowSpeed, arrowImage)

        healthBar(player, context, canvas)
        GameOver(player, context, request)
        if (enemiesList.length === 0) {
            level += 1;
            subgameFinished = false;
            loadSubGame = false;
            paused = true;
        }
    }
}

//level5()
function level5() {
    backgroundMusic.play();
    player.x = 50;
    player.y = 200;
    document.getElementById("title").innerHTML = "Level " + String(level);
    document.getElementById("underGame").innerHTML =
        "Landmines will explode if you walk near them<br>They won't affect normal enemies";

    backgroundCountX = 0;
    backgroundCountY = 0;
    enemiesList = [];
    landmineList = [];
    obstacleList = [];
    arrowList = [];

    assignObstacles(background5, obstacleList, tileSize, [13, 27, 15, 66])

    let skeleton = {
        x: 300,
        y: 200,
        height: 48,
        width: 32,
        frameX: 0,
        frameY: 0,
        xChange: 1,
        yChange: 0,
        count: 0,
        health: 100,
        wepon: "bow",
        bowFrameX: 0,
        bowFrameY: 0,
        character: "skeleton",
        movement: true
    };
    let wizard = {
        x: 100,
        y: 100,
        height: 48,
        width: 32,
        frameX: 0,
        frameY: 0,
        xChange: 1,
        yChange: 0,
        health: 100,
        character: "wizard",
        spellX: 0,
        spellY: 0,
        spellCount: 0,
        count: 0,
        movement: true
    };

    wizard.x = 300;
    wizard.y = 200;
    enemiesList.push(wizard);
    enemiesList.push(skeleton);
    landmineList.push(landmine);
}

function drawLevel5() {
    if (level === 5) {
        tilesPerRow = 10;
        drawBackground(context, background5, canvas, tilesPerRow, tiny16Image, tileSize)

        common(canvas, context, player, enemiesList, obstacleList, playerImage, lizardImage, skeletonImage, wizardImage,
            moveDown, moveLeft, moveRight, moveUp, sword, bow, arrowList, bowImage, swordImage, arrowSpeed, arrowImage)

        healthBar(player, context, canvas)

        GameOver(player, context, request)
        if (enemiesList.length === 0) {
            level += 1;
            subgameFinished = false;
            loadSubGame = false;
            paused = true;
        }
    }
}

//level6()
function level6() {
    backgroundMusic.play();
    player.x = 50;
    player.y = 200;
    document.getElementById("title").innerHTML = "Level " + String(level);
    document.getElementById("underGame").innerHTML =
        "You must defeat the enemies in the dark<br>Your arrows will tell you what side the enemy is on";

    backgroundCountX = 0;
    backgroundCountY = 0;
    enemiesList = [];
    landmineList = [];
    obstacleList = [];
    arrowList = [];

    assignObstacles(background6, obstacleList, tileSize, [27, 17, 18, 37, 19])

    let wizard = {
        x: 100,
        y: 100,
        height: 48,
        width: 32,
        frameX: 0,
        frameY: 0,
        xChange: 1,
        yChange: 0,
        health: 100,
        character: "wizard",
        spellX: 0,
        spellY: 0,
        spellCount: 0,
        count: 0,
        movement: true
    };
    enemiesList.push(wizard);
}

function drawLevel6() {
    if (level === 6) {
        tilesPerRow = 10
        drawBackground(context, background6, canvas, tilesPerRow, tiny16Image, tileSize)
        common(canvas, context, player, enemiesList, obstacleList, playerImage, lizardImage, skeletonImage, wizardImage,
            moveDown, moveLeft, moveRight, moveUp, sword, bow, arrowList, bowImage, swordImage, arrowSpeed, arrowImage)

        blackout(context, player, canvas)

        healthBar(player, context, canvas)
        GameOver(player, context, request)
        if (enemiesList.length === 0) {
            level += 1;
            subgameFinished = false;
            loadSubGame = false;
            paused = true;
        }
    }
}

//level7()
function level7() {
    backgroundMusic.play();
    player.x = 50;
    player.y = 200;
    document.getElementById("title").innerHTML = "Level " + String(level);
    document.getElementById("underGame").innerHTML =
        "You can explore this map by running into the edge of the screen<br>You should try running to the right first";

    backgroundCountX = 0;
    backgroundCountY = 0;
    enemiesList = [];
    landmineList = [];
    obstacleList = [];
    arrowList = [];

    tileSize = 24;
    assignObstacles(background7, obstacleList, tileSize, [83, 33, 86, 84])

    let lizard = {
        x: 32,
        y: 48,
        height: 48,
        width: 39,
        frameX: 0,
        frameY: 0,
        xChange: 1,
        yChange: 0,
        character: "lizard",
        count: 0,
        health: 100,
        movement: true
    };

    lizard.x = 300
    lizard.y = 300
    enemiesList.push(lizard);
}

function drawLevel7() {
    if (level === 7) {
        tileSize = 24;
        tilesPerRow = 16;
        drawBackground(context, background7, canvas, tilesPerRow, caveImage, tileSize)
        common(canvas, context, player, enemiesList, obstacleList, playerImage, lizardImage, skeletonImage, wizardImage,
            moveDown, moveLeft, moveRight, moveUp, sword, bow, arrowList, bowImage, swordImage, arrowSpeed, arrowImage)

        healthBar(player, context, canvas)
        GameOver(player, context, request)
        if (enemiesList.length === 0) {
            level += 1;
            subgameFinished = false;
            loadSubGame = false;
            paused = true;
        }
    }
}


function level8() {
    backgroundMusic.play();
    player.x = 50;
    player.y = 200;
    document.getElementById("title").innerHTML = "Level " + String(level);
    document.getElementById("underGame").innerHTML =
        "Touching a dragon will kill you instantly<br>They will be hurt if they walk over landmines";
    backgroundCountX = 0;
    backgroundCountY = 0;
    enemiesList = [];
    landmineList = [];
    obstacleList = [];
    arrowList = [];
    tileSize = 24;
    assignObstacles(background7, obstacleList, tileSize, [83, 33, 86, 84])

    let dragon = {
        x: 360,
        y: 50,
        height: 96,
        width: 96,
        frameX: 0,
        frameY: 0,
        xChange: 1,
        yChange: 0,
        health: 400,
        character: "dragon",
        count: 0,
        movement: true
    };
    enemiesList.push(dragon);

    let landmine = {
        x: 180,
        y: 250,
        height: 16,
        width: 16,
        distance: 1000,
        pictureWidth: 256,
        pictureHeight: 256,
        pictureX: 0,
        pictureY: 0,
        explode: false
    }

    landmineList.push(landmine);

    landmine = {
        x: 280,
        y: 250,
        height: 16,
        width: 16,
        distance: 1000,
        pictureWidth: 256,
        pictureHeight: 256,
        pictureX: 0,
        pictureY: 0,
        explode: false
    }

    landmineList.push(landmine);

    landmine = {
        x: 380,
        y: 250,
        height: 16,
        width: 16,
        distance: 1000,
        pictureWidth: 256,
        pictureHeight: 256,
        pictureX: 0,
        pictureY: 0,
        explode: false
    }
    landmineList.push(landmine);
}

function drawLevel8() {
    if (level === 8) {
        tileSize = 24;
        tilesPerRow = 16;
        drawBackground(context, background7, canvas, tilesPerRow, caveImage, tileSize)
        common(canvas, context, player, enemiesList, obstacleList, playerImage, lizardImage, skeletonImage, wizardImage,
            moveDown, moveLeft, moveRight, moveUp, sword, bow, arrowList, bowImage, swordImage, arrowSpeed, arrowImage)

        healthBar(player, context, canvas)
        GameOver(player, context, request)
        if (enemiesList.length === 0) {
            level += 1
            subgameFinished = false;
            loadSubGame = false;
            paused = true;
        }
    }
}


function level9() {
    backgroundMusic.play();
    player.x = 50;
    player.y = 200;
    document.getElementById("title").innerHTML = "Level " + String(level);
    document.getElementById("underGame").innerHTML =
        "Killing the dragon gave you special powers<br>Click with the mouse to summon a tornado<br>Press Space to teleport";
    backgroundCountX = 0;
    backgroundCountY = 0;
    enemiesList = [];
    landmineList = [];
    obstacleList = [];
    arrowList = [];
    tileSize = 16;
    assignObstacles(background9, obstacleList, tileSize, [18])

    let wizard = {
        x: canvas.width * .5,
        y: 40,
        height: 48,
        width: 32,
        frameX: 0,
        frameY: 0,
        xChange: 1,
        yChange: 0,
        health: 100,
        character: "wizard",
        spellX: 0,
        spellY: 0,
        spellCount: 0,
        count: 0,
        movement: true
    };
    enemiesList.push(wizard);
}

function drawLevel9() {
    if (level === 9) {
        tileSize = 16;
        tilesPerRow = 10;
        drawBackground(context, background9, canvas, tilesPerRow, tiny16Image, tileSize)
        common(canvas, context, player, enemiesList, obstacleList, playerImage, lizardImage, skeletonImage, wizardImage,
            moveDown, moveLeft, moveRight, moveUp, sword, bow, arrowList, bowImage, swordImage, arrowSpeed, arrowImage)

        healthBar(player, context, canvas)
        GameOver(player, context, request)
        if (enemiesList.length === 0) {
            level += 1;
            subgameFinished = false;
            loadSubGame = false;
            paused = true;
        }
    }
}


function level10() {
    backgroundMusic.play();
    player.x = 50;
    player.y = 200;
    document.getElementById("title").innerHTML = "Level " + String(level);
    document.getElementById("underGame").innerHTML =
        "You found the princess!<br><br>Kill her";
    backgroundCountX = 0;
    backgroundCountY = 0;
    enemiesList = [];
    landmineList = [];
    obstacleList = [];
    arrowList = [];
    tileSize = 16;
    assignObstacles(background9, obstacleList, tileSize, [18])

    let princess = {
        x: canvas.width * .5,
        y: 40,
        height: 48,
        width: 32,
        frameX: 0,
        frameY: 0,
        health: 100,
        character: "princess"
    };
    enemiesList.push(princess);
}

function drawLevel10() {
    if (level === 10) {
        tileSize = 16;
        tilesPerRow = 10;
        drawBackground(context, background9, canvas, tilesPerRow, tiny16Image, tileSize)
        common(canvas, context, player, enemiesList, obstacleList, playerImage, lizardImage, skeletonImage, wizardImage,
            moveDown, moveLeft, moveRight, moveUp, sword, bow, arrowList, bowImage, swordImage, arrowSpeed, arrowImage)

        healthBar(player, context, canvas)
        GameOver(player, context, request)
        if (enemiesList.length === 0) {
            level += 1;
        }
    }
}

function finished() {
    context.fillStyle = "black"
    context.fillRect(0, 0, canvas.width, canvas.height)
    context.font = "50px Ariel";
    context.fillStyle = "red";
    context.textAlign = "center";
    context.fillText("You Win", canvas.width / 2, canvas.height / 2);
    context.drawImage(explodeImage,
        landmine.pictureWidth * landmine.pictureX, landmine.pictureHeight * landmine.pictureY,
        landmine.pictureWidth, landmine.pictureHeight,
        0, 0, landmine.width * 5, landmine.height * 5);
    context.drawImage(explodeImage,
        landmine.pictureWidth * landmine.pictureX, landmine.pictureHeight * landmine.pictureY,
        landmine.pictureWidth, landmine.pictureHeight,
        462-25, 0, landmine.width * 5, landmine.height * 5);
    context.drawImage(explodeImage,
        landmine.pictureWidth * landmine.pictureX, landmine.pictureHeight * landmine.pictureY,
        landmine.pictureWidth, landmine.pictureHeight,
        0, 270-25, landmine.width * 5, landmine.height * 5);
    context.drawImage(explodeImage,
        landmine.pictureWidth * landmine.pictureX, landmine.pictureHeight * landmine.pictureY,
        landmine.pictureWidth, landmine.pictureHeight,
        462-25, 270-25, landmine.width * 5, landmine.height * 5);
    landmine.pictureX += 1;
    if (landmine.pictureX === 8) {
        landmine.pictureX = 0;
        landmine.pictureY += 1;
    }
    if (landmine.pictureX  > 8) {
        landmine.pictureX = 0;
    }
    if (landmine.pictureY  > 4) {
        landmine.pictureY = 0;
    }
}

function initialise() {
    healthpackList = [];
    score = 0;
    backgroundCount = 1;
    boost = false;
    tilesPerRow = 10;
    tileSize = 16;
    subgameFinished = false;
    paused = true;
    characterSelection = false;
    gameToGame = false;
    loadSubGame = false;
    loadLevel1 = false;
    loadLevel2 = false;
    loadLevel3 = false;
    loadLevel4 = false;
    loadLevel5 = false;
    loadLevel6 = false;
    loadLevel7 = false;
    loadLevel8 = false;
    loadLevel9 = false;
    loadLevel10 = false;
    tutorialLoad = false;
    gameLoad = false;
    gameLoaded = false;
    scoreSubmitted = false;
    enemiesList = [];
    activeTornado = false;
    tornadoCount = 0;
    arrowSpeed = 6;
    arrowList = [];
    obstacleList = [];
    landmineList = [];
    moveLeft = false;
    moveUp = false;
    moveRight = false;
    moveDown = false;
    level = 1;
    player.teleportCount = 0;
    player.teleporting = false;
    player.invincible = false;
}